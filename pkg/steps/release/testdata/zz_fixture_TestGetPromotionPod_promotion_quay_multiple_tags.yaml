metadata:
  creationTimestamp: null
  labels:
    ci-operator.openshift.io/save-container-logs: "true"
  name: promotion-quay
  namespace: ci-op-9bdij1f6
spec:
  containers:
  - args:
    - |-
      oc image mirror --loglevel=2 --keep-manifest-list --registry-config=/etc/push-secret/.dockerconfigjson --max-per-registry=10 quay.io/openshift/ci:ocp_4.21_ovn-kubernetes=quay.io/openshift/ci:20240603235401_prune_ovn-kubernetes quay.io/openshift/ci:ocp_4.21_ovn-kubernetes-base=quay.io/openshift/ci:20240603235401_prune_ovn-kubernetes-base quay.io/openshift/ci:ocp_4.21_ovn-kubernetes-microshift=quay.io/openshift/ci:20240603235401_prune_ovn-kubernetes-microshift || true
      for r in {1..5}; do echo Mirror attempt $r; oc image mirror --loglevel=2 --keep-manifest-list --registry-config=/etc/push-secret/.dockerconfigjson --max-per-registry=10 registry.build02.ci.openshift.org/ci-op-y2n8rsh3/pipeline@sha256:aaa=quay.io/openshift/ci:ocp_4.21_ovn-kubernetes registry.build02.ci.openshift.org/ci-op-y2n8rsh3/pipeline@sha256:bbb=quay.io/openshift/ci:ocp_4.21_ovn-kubernetes-base registry.build02.ci.openshift.org/ci-op-y2n8rsh3/pipeline@sha256:ccc=quay.io/openshift/ci:ocp_4.21_ovn-kubernetes-microshift && break; backoff=$(($RANDOM % 120))s; echo Sleeping randomized $backoff before retry; sleep $backoff; done
      set +e
      for r in {1..2}; do echo 'Tag attempt $r (all together)'; oc tag --source=docker --loglevel=2 --reference-policy='source' --import-mode='PreserveOriginal' --reference quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes ocp/4.21:ovn-kubernetes quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes-base ocp/4.21:ovn-kubernetes-base quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes-microshift ocp/4.21:ovn-kubernetes-microshift && break; :; done
      for r in {1..3}; do echo 'Tag attempt $r (individual)'; oc tag --source=docker --loglevel=2 --reference-policy='source' --import-mode='PreserveOriginal' --reference quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes ocp/4.21:ovn-kubernetes && break; backoff=$(($RANDOM % 120))s; echo Sleeping randomized $backoff before retry; sleep $backoff; done
      for r in {1..3}; do echo 'Tag attempt $r (individual)'; oc tag --source=docker --loglevel=2 --reference-policy='source' --import-mode='PreserveOriginal' --reference quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes-base ocp/4.21:ovn-kubernetes-base && break; backoff=$(($RANDOM % 120))s; echo Sleeping randomized $backoff before retry; sleep $backoff; done
      for r in {1..3}; do echo 'Tag attempt $r (individual)'; oc tag --source=docker --loglevel=2 --reference-policy='source' --import-mode='PreserveOriginal' --reference quay-proxy.ci.openshift.org/openshift/ci:ocp_4.21_ovn-kubernetes-microshift ocp/4.21:ovn-kubernetes-microshift && break; backoff=$(($RANDOM % 120))s; echo Sleeping randomized $backoff before retry; sleep $backoff; done
      set -e
    command:
    - /bin/sh
    - -c
    env:
    - name: KUBECONFIG
      value: /etc/app-ci-kubeconfig/kubeconfig
    image: registry.ci.openshift.org/ocp/4.14:cli
    name: promotion
    resources: {}
    volumeMounts:
    - mountPath: /etc/push-secret
      name: push-secret
      readOnly: true
    - mountPath: /etc/app-ci-kubeconfig
      name: app-ci-kubeconfig
      readOnly: true
  nodeSelector:
    kubernetes.io/arch: amd64
  restartPolicy: Never
  volumes:
  - name: push-secret
    secret:
      secretName: registry-push-credentials-ci-central
  - name: app-ci-kubeconfig
    secret:
      secretName: promotion-quay-tagger-kubeconfig
status: {}
